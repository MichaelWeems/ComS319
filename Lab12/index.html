<html>
    <head>
        <script src="http://localhost:5000/socket.io/socket.io.js"></script>
        <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
        <style>
            table, th, td{ border: 1px solid black;}
            th {background-color:darksalmon;}
            table{float:left; padding: 1px;}
        </style>
    </head>
    <body>
      <div class="login">
          Username<input type="text" id="user">
          <input type="button" id="lgn" value="Login">
      </div>
      <div class="chat" style="display:none">
        Title<input type="text" id="title"><br>
        Message<input type="text" id="mess">
        <input type="button" id="btn" value="Submit Message"><br>
        <div class="posts"></div>
        <div class="users"></div>
    
        <div id="msg"></div>
      </div>
        <script>
            var username = "";
            // connect to WEBSOCKET server
            var socket = io.connect('http://localhost:5000');
            
            $('#lgn').click(function(){
              username = $('#user').val();
              $('#user').val("");
              $('.login').hide();
              console.log(username);
              socket.emit('login', username);
              $('.chat').show();
            });
            
            $('#btn').click(function(){
                socket.emit('message', {mess:$('#mess').val(), title:$('#title').val(), name:username});
                $('#mess').val("");
                $('#title').val("");
            });

            socket.on('post', function(data){
              var post = "<table><tr><th>User</th><th>Title</th><th>Message</th><th>Edit</th></tr>";
              data.reverse();
              data.forEach(function(message){
                post += "<tr><td>"+message.name+"</td><td>"+message.title+"</td><td>"+message.mess+"</td>";
                if(message.name == username)
                  post += "<td onclick='edit("+message.index+")'>edit</td><tr>";
                else
                  post += "<td></td><tr>";
                
              });
              post += "</table>";
              $('.posts table').remove();
              $('.posts').append(post);
                
            });
            
            function edit(index){
              var txt = $('#mess').val();
              var ttl = $('#title').val();
              $('#mess').val("");
              $('#title').val();
              socket.emit('edit', {title:ttl, text:txt, index:index});
            };
            
            
            socket.on('update', function(data){
              var post = "<table><tr><th>Users Logged In</th></tr>";
              data.forEach(function(name){
                post += "<tr><td>"+name+"</td></tr>"; 
              });
              post += "</table>";
              $('.users table').remove();
              $('.users').append(post);
            });
            
        </script>
    </body>
</html>
