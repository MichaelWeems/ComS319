<!DOCTYPE html>
<HTML>
<!-- 
– use'ajax'call'to'/checkLogin.php'file'to'check'user/password
– on'success'go'to'viewPosts.php
– on'failure'– ask'the'user'to'correct'the'username'and'password 
-->
<HEAD>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<link rel="stylesheet" type="text/css" href="posts.css">
</HEAD>
<BODY>

<div class="loginDiv">
username <input type="text" name="username" id="username"/> <br>
password <input type="text" name="password" id="password"/> <br>
<input type="button" value="Login" id="login" style="width:236px"/>

</div>

<div class="app">
	<div class="createPosts">
		<h4>Submit a new Post</h4>
		<input type="text" id="Title" placeholder="Title" /> <br>
		<input type="text" id="Message" placeholder="Message" size="50"/>
		<input type="button" id="submit" value="Submit" style="background:lightblue"/>
		&nbsp&nbsp&nbsp&nbsp&nbsp
		<input type="button" id="logout" value="logout" />
	</div>
	<div class="viewPosts" style="margin-top:20px"></div>
</div>

</BODY>

<script> 
$(document).ready(function() {

$(".app").hide();
$('.createPosts').hide();

$("#submit").click(function() {
	console.log("Adding post:");
	console.log("\tTitle: " + $("#Title").val());
	console.log("\tMessage: " + $("#Message").val());
	
	$.post("updatePosts.php", {title: $("#Title").val(), message: $("#Message").val()}, 
		function(data) {	
			console.log("data: " + data);
			console.log("Added a post, now attempting to refresh the page");
			$.post("viewPosts.php", {username: $("#username").val()}, 
			function(data) {
				$('.viewPosts').html(data);
				console.log("...Refresh Successful!");
			});
	});
});

$("#login").click (function () {
  
  req = "username=" + $("#username").val();
  req += "&password=" + $("#password").val();
  
  console.log("checkLogin.php?" + req);
  $.get("checkLogin.php?" + req, 
        function(data,status) {
			console.log("Login was successful: " + data);
			if ( data == "true" ) {
				$(".loginDiv,.app").toggle();
				$('.createPosts').show();
				$.post("viewPosts.php", {username: $("#username").val()},
					function (data) {
						$(".viewPosts").html(data);
					});
			}
			else {
				alert("Incorrect login information");
				$("#username").val("");
				$("#password").val("");
			}
   });
});

$("#logout").click (function () {
	$.post("logout.php", {}, function(data) {
			console.log(data);
		 $("#includedContent").load("login.html"); 
	});
});


}); // end of document ready function

function edit( ind ) {
// edit the post at index
	console.log("Edit function: " + ind);
	
	var newPost = prompt("Enter a new message:", "");
	var i = ind;
	
	$.post("updatePosts.php", {index: i, message: newPost},
		function (data, index) {
			console.log(data);
			$.post("viewPosts.php", {username: $("#username").val()},
					function (data, index) {
						$(".viewPosts").html(data);
					});
		});
}

</script>

</HTML>